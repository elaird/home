#!/usr/bin/env python

import time

def loop(nMins = 25, sleepSec = 60, linesAbove = 60, linesBelow = 20) :
    #tomato from http://members.fortunecity.com/stereogram/tomato.html
    tomato = r'''
                   ,
                  /.\
                 //_`\
            _.-`| \ ``._
        .-''`-.       _.'`.
      .'      / /'\/`.\    `. 
     /   .    |/         `.  \
    '   /                  \  ;
   :   '            \       : :
   ;  ;    %s       ;      /  .
    ' :             .     '  /
     \ \           /       .'
      `.`        .'      .'
        `-..___....----`

'''

    for minute in range(nMins, 0, -1) :
        print "\n"*linesAbove
        print tomato%("%2d"%minute)
        print "\n"*linesBelow
        time.sleep(sleepSec)

def end(title = "pomodoro", message = "", kde = True, bell = False) :
    if kde :
        import dbus
        knotify = dbus.SessionBus().get_object("org.kde.knotify", "/Notify")
        knotify.event("warning", "kde", [], title, message, [], [], 0, 0, dbus_interface="org.kde.KNotify")
    elif message : 
        print message
    if bell :
        print '\a'

if __name__ == "__main__" :
    import sys
    kde = "--noKDE" not in sys.argv 
    bell = "--bell" in sys.argv
    message = next( reversed(filter(lambda s: s[0]!='-',sys.argv[1:])), "")
    loop()
    end(message = message, kde = kde, bell = bell)
